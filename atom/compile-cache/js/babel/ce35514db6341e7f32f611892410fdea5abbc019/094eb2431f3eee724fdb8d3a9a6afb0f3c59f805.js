Object.defineProperty(exports, '__esModule', {
	value: true
});
/** @babel */

var init = function init() {
	var editor = atom.workspace.getActiveTextEditor();
	if (!editor) {
		return;
	}

	var buffer = editor.getBuffer();
	if (typeof buffer.editorconfig === 'undefined') {
		return;
	}

	var settings = buffer.editorconfig.settings;

	var softTabs = settings.indent_style === 'space';
	var checkpoint = buffer.createCheckpoint();
	var fixedProperties = {
		endOfLine: 0,
		indentStyle: 0
	};

	// Fix end_of_line, if necessary
	if (settings.end_of_line !== 'unset') {
		var lastRow = buffer.getLastRow();
		for (var i = 0; i < lastRow; i++) {
			if (buffer.lineEndingForRow(i) !== settings.end_of_line && buffer.lineEndingForRow(i) !== '') {
				buffer.setTextInRange([[i, buffer.lineLengthForRow(i)], [i + 1, 0]], settings.end_of_line, { normalizeLineEndings: false });
				fixedProperties.endOfLine++;
			}
		}
	}

	// Fix indent_style, if necessary
	if (settings.indent_style !== 'unset') {
		(function () {
			var spaceChar = { 'true': ' ', 'false': '\\t' };
			var tabLength = editor.getTabLength();
			// Match only malformed (containing at least one wrong tab-char) lines
			var searchPattern = '^([' + spaceChar[softTabs] + ']*[' + spaceChar[!softTabs] + ']\\s*)';

			if (tabLength > 0) {
				buffer.backwardsScan(new RegExp(searchPattern, 'gm'), function (scan) {
					var columns = scan.matchText.split('').reduce(function (prev, curr) {
						fixedProperties.indentStyle += 1;

						if (curr === ' ') {
							return prev + 1;
						}

						return prev + tabLength - prev % tabLength;
					}, 0);

					Math.max(columns, Math.floor(columns / tabLength));
					if (softTabs === true) {
						scan.replace(' '.repeat(columns));
					} else {
						var tabString = '\t'.repeat(Math.floor(columns / tabLength));
						var remainingSpaces = ' '.repeat(columns % tabLength);
						scan.replace(tabString.concat(remainingSpaces));
					}
				});
			}
		})();
	}

	if (softTabs) {
		fixedProperties.indentStyle = Math.floor(fixedProperties.indentStyle / editor.getTabLength());
	}

	var changesInTotal = 0;
	Object.keys(fixedProperties).forEach(function (k) {
		changesInTotal += fixedProperties[k];
	});

	// Prepare notification & save changes
	var notificationOptions = { dismissable: true };
	if (changesInTotal > 0) {
		var styleName = softTabs === true ? 'Tab(s)' : 'Space(s)';

		buffer.groupChangesSinceCheckpoint(checkpoint);
		notificationOptions.description = '\n|Fixed EditorConfig-Properties||\n|--------|------:|\n|`end_of_line`|' + fixedProperties.endOfLine + '|\n|`indent_style`|' + fixedProperties.indentStyle + ' ' + styleName + '|\n|Changes in total|**' + changesInTotal + '**|\n';
	} else {
		notificationOptions.description = '\nThe file ' + editor.getTitle() + ' conformed to the `end_of_line` and `indent_style` properties.\nNo changes were applied.\n';
	}

	atom.notifications.addSuccess(editor.getTitle(), notificationOptions);
};

var subscriber = function subscriber() {
	atom.commands.add('atom-workspace', 'EditorConfig:fix-file', init);
};

exports['default'] = subscriber;
exports.init = init;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb3NoL2RvdGZpbGVzL2F0b20vcGFja2FnZXMvZWRpdG9yY29uZmlnL2NvbW1hbmRzL2ZpeC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLElBQU0sSUFBSSxHQUFHLFNBQVAsSUFBSSxHQUFTO0FBQ2xCLEtBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztBQUNwRCxLQUFJLENBQUMsTUFBTSxFQUFFO0FBQ1osU0FBTztFQUNQOztBQUVELEtBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNsQyxLQUFJLE9BQU8sTUFBTSxDQUFDLFlBQVksS0FBSyxXQUFXLEVBQUU7QUFDL0MsU0FBTztFQUNQOztLQUVNLFFBQVEsR0FBSSxNQUFNLENBQUMsWUFBWSxDQUEvQixRQUFROztBQUNmLEtBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO0FBQ25ELEtBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQzdDLEtBQU0sZUFBZSxHQUFHO0FBQ3ZCLFdBQVMsRUFBRSxDQUFDO0FBQ1osYUFBVyxFQUFFLENBQUM7RUFDZCxDQUFDOzs7QUFHRixLQUFJLFFBQVEsQ0FBQyxXQUFXLEtBQUssT0FBTyxFQUFFO0FBQ3JDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUNwQyxPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ2pDLE9BQUksTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxXQUFXLElBQ3RELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7QUFDbkMsVUFBTSxDQUFDLGNBQWMsQ0FDcEIsQ0FDQyxDQUFDLENBQUMsRUFBRSxNQUFN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QyxXQUFXLFNBQUksU0FBUywrQkFDdEMsY0FBYyxVQUNuQyxDQUFDO0VBQ0EsTUFBTTtBQUNOLHFCQUFtQixDQUFDLFdBQVcsbUJBQ3RCLE1BQU0sQ0FBQyxRQUFRLEVBQUUsK0ZBRTNCLENBQUM7RUFDQTs7QUFFRCxLQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztDQUN0RSxDQUFDOztBQUVGLElBQU0sVUFBVSxHQUFHLFNBQWIsVUFBVSxHQUFTO0FBQ3hCLEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLHVCQUF1QixFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ25FLENBQUM7O3FCQUVNLFVBQVU7UUFBYSxJQUFJLEdBQUosSUFBSSIsImZpbGUiOiIvVXNlcnMvam9zaC9kb3RmaWxlcy9hdG9tL3BhY2thZ2VzL2VkaXRvcmNvbmZpZy9jb21tYW5kcy9maXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQGJhYmVsICovXG5cbmNvbnN0IGluaXQgPSAoKSA9PiB7XG5cdGNvbnN0IGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKTtcblx0aWYgKCFlZGl0b3IpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRjb25zdCBidWZmZXIgPSBlZGl0b3IuZ2V0QnVmZmVyKCk7XG5cdGlmICh0eXBlb2YgYnVmZmVyLmVkaXRvcmNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRjb25zdCB7c2V0dGluZ3N9ID0gYnVmZmVyLmVkaXRvcmNvbmZpZztcblx0Y29uc3Qgc29mdFRhYnMgPSBzZXR0aW5ncy5pbmRlbnRfc3R5bGUgPT09ICdzcGFjZSc7XG5cdGNvbnN0IGNoZWNrcG9pbnQgPSBidWZmZXIuY3JlYXRlQ2hlY2twb2ludCgpO1xuXHRjb25zdCBmaXhlZFByb3BlcnRpZXMgPSB7XG5cdFx0ZW5kT2ZMaW5lOiAwLFxuXHRcdGluZGVudFN0eWxlOiAwXG5cdH07XG5cblx0Ly8gRml4IGVuZF9vZl9saW5lLCBpZiBuZWNlc3Nhcnlcblx0aWYgKHNldHRpbmdzLmVuZF9vZl9saW5lICE9PSAndW5zZXQnKSB7XG5cdFx0Y29uc3QgbGFzdFJvdyA9IGJ1ZmZlci5nZXRMYXN0Um93KCk7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsYXN0Um93OyBpKyspIHtcblx0XHRcdGlmIChidWZmZXIubGluZUVuZGluZ0ZvclJvdyhpKSAhPT0gc2V0dGluZ3MuZW5kX29mX2xpbmUgJiZcblx0XHRcdFx0YnVmZmVyLmxpbmVFbmRpbmdGb3JSb3coaSkgIT09ICcnKSB7XG5cdFx0XHRcdGJ1ZmZlci5zZXRUZXh0SW5SYW5nZShcblx0XHRcdFx0XHRbXG5cdFx0XHRcdFx0XHRbaSwgYnVmZmVyLmxpbmVMZW5ndGhGb3JSb3coaSldLFxuXHRcdFx0XHRcdFx0W2kgKyAxLCAwXVxuXHRcdFx0XHRcdF0sXG5cdFx0XHRcdFx0c2V0dGluZ3MuZW5kX29mX2xpbmUsXG5cdFx0XHRcdFx0e25vcm1hbGl6ZUxpbmVFbmRpbmdzOiBmYWxzZX1cblx0XHRcdFx0KTtcblx0XHRcdFx0Zml4ZWRQcm9wZXJ0aWVzLmVuZE9mTGluZSsrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8vIEZpeCBpbmRlbnRfc3R5bGUsIGlmIG5lY2Vzc2FyeVxuXHRpZiAoc2V0dGluZ3MuaW5kZW50X3N0eWxlICE9PSAndW5zZXQnKSB7XG5cdFx0Y29uc3Qgc3BhY2VDaGFyID0ge3RydWU6ICcgJywgZmFsc2U6ICdcXFxcdCd9O1xuXHRcdGNvbnN0IHRhYkxlbmd0aCA9IGVkaXRvci5nZXRUYWJMZW5ndGgoKTtcblx0XHQvLyBNYXRjaCBvbmx5IG1hbGZvcm1lZCAoY29udGFpbmluZyBhdCBsZWFzdCBvbmUgd3JvbmcgdGFiLWNoYXIpIGxpbmVzXG5cdFx0Y29uc3Qgc2VhcmNoUGF0dGVybiA9IGBeKFske3NwYWNlQ2hhcltzb2Z0VGFic119XSpbJHtzcGFjZUNoYXJbIXNvZnRUYWJzXX1dXFxcXHMqKWA7XG5cblx0XHRpZiAodGFiTGVuZ3RoID4gMCkge1xuXHRcdFx0YnVmZmVyLmJhY2t3YXJkc1NjYW4obmV3IFJlZ0V4cChzZWFyY2hQYXR0ZXJuLCAnZ20nKSwgc2NhbiA9PiB7XG5cdFx0XHRcdGNvbnN0IGNvbHVtbnMgPSBzY2FuLm1hdGNoVGV4dC5zcGxpdCgnJykucmVkdWNlKChwcmV2LCBjdXJyKSA9PiB7XG5cdFx0XHRcdFx0Zml4ZWRQcm9wZXJ0aWVzLmluZGVudFN0eWxlICs9IDE7XG5cblx0XHRcdFx0XHRpZiAoY3VyciA9PT0gJyAnKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcHJldiArIDE7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHByZXYgKyB0YWJMZW5ndGggLSAocHJldiAlIHRhYkxlbmd0aCk7XG5cdFx0XHRcdH0sIDApO1xuXG5cdFx0XHRcdE1hdGgubWF4KFxuXHRcdFx0XHRcdGNvbHVtbnMsIE1hdGguZmxvb3IoY29sdW1ucyAvIHRhYkxlbmd0aClcblx0XHRcdFx0KTtcblx0XHRcdFx0aWYgKHNvZnRUYWJzID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0c2Nhbi5yZXBsYWNlKCcgJy5yZXBlYXQoY29sdW1ucykpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnN0IHRhYlN0cmluZyA9ICdcXHQnLnJlcGVhdChNYXRoLmZsb29yKGNvbHVtbnMgLyB0YWJMZW5ndGgpKTtcblx0XHRcdFx0XHRjb25zdCByZW1haW5pbmdTcGFjZXMgPSAnICcucmVwZWF0KGNvbHVtbnMgJSB0YWJMZW5ndGgpO1xuXHRcdFx0XHRcdHNjYW4ucmVwbGFjZSh0YWJTdHJpbmcuY29uY2F0KHJlbWFpbmluZ1NwYWNlcykpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRpZiAoc29mdFRhYnMpIHtcblx0XHRmaXhlZFByb3BlcnRpZXMuaW5kZW50U3R5bGUgPSBNYXRoLmZsb29yKFxuXHRcdFx0Zml4ZWRQcm9wZXJ0aWVzLmluZGVudFN0eWxlIC8gZWRpdG9yLmdldFRhYkxlbmd0aCgpXG5cdFx0KTtcblx0fVxuXG5cdGxldCBjaGFuZ2VzSW5Ub3RhbCA9IDA7XG5cdE9iamVjdC5rZXlzKGZpeGVkUHJvcGVydGllcykuZm9yRWFjaChrID0+IHtcblx0XHRjaGFuZ2VzSW5Ub3RhbCArPSBmaXhlZFByb3BlcnRpZXNba107XG5cdH0pO1xuXG5cdC8vIFByZXBhcmUgbm90aWZpY2F0aW9uICYgc2F2ZSBjaGFuZ2VzXG5cdGNvbnN0IG5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7ZGlzbWlzc2FibGU6IHRydWV9O1xuXHRpZiAoY2hhbmdlc0luVG90YWwgPiAwKSB7XG5cdFx0Y29uc3Qgc3R5bGVOYW1lID0gc29mdFRhYnMgPT09IHRydWUgPyAnVGFiKHMpJyA6ICdTcGFjZShzKSc7XG5cblx0XHRidWZmZXIuZ3JvdXBDaGFuZ2VzU2luY2VDaGVja3BvaW50KGNoZWNrcG9pbnQpO1xuXHRcdG5vdGlmaWNhdGlvbk9wdGlvbnMuZGVzY3JpcHRpb24gPSBgXG58Rml4ZWQgRWRpdG9yQ29uZmlnLVByb3BlcnRpZXN8fFxufC0tLS0tLS0tfC0tLS0tLTp8XG58XFxgZW5kX29mX2xpbmVcXGB8JHtmaXhlZFByb3BlcnRpZXMuZW5kT2ZMaW5lfXxcbnxcXGBpbmRlbnRfc3R5bGVcXGB8JHtmaXhlZFByb3BlcnRpZXMuaW5kZW50U3R5bGV9ICR7c3R5bGVOYW1lfXxcbnxDaGFuZ2VzIGluIHRvdGFsfCoqJHtjaGFuZ2VzSW5Ub3RhbH0qKnxcbmA7XG5cdH0gZWxzZSB7XG5cdFx0bm90aWZpY2F0aW9uT3B0aW9ucy5kZXNjcmlwdGlvbiA9IGBcblRoZSBmaWxlICR7ZWRpdG9yLmdldFRpdGxlKCl9IGNvbmZvcm1lZCB0byB0aGUgXFxgZW5kX29mX2xpbmVcXGAgYW5kIFxcYGluZGVudF9zdHlsZVxcYCBwcm9wZXJ0aWVzLlxuTm8gY2hhbmdlcyB3ZXJlIGFwcGxpZWQuXG5gO1xuXHR9XG5cblx0YXRvbS5ub3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoZWRpdG9yLmdldFRpdGxlKCksIG5vdGlmaWNhdGlvbk9wdGlvbnMpO1xufTtcblxuY29uc3Qgc3Vic2NyaWJlciA9ICgpID0+IHtcblx0YXRvbS5jb21tYW5kcy5hZGQoJ2F0b20td29ya3NwYWNlJywgJ0VkaXRvckNvbmZpZzpmaXgtZmlsZScsIGluaXQpO1xufTtcblxuZXhwb3J0IHtzdWJzY3JpYmVyIGFzIGRlZmF1bHQsIGluaXR9O1xuIl19